# Lec6 Raft-PART 1⃣️

> 在之前的课程中，介绍了几个具有容错机制的系统。实际上他们有共同的特点：
>
> * **MapReduce**对计算进行了复制，但整个系统被**单一Master节点**操控
> * **GFS**以主备方式复制对存储的数据进行了复制，但整个系统也依赖**单一Master节点**来提供数据存储位置的map
> * **VMware Fault-Tolerance**，在一个Primary虚拟机和一个Backup虚拟机之间对命令进行了复制，需要一个Test-and-Set服务进行确认，且Primary和Backup**只有一个**能进行请求的响应输出

这三个例子都是多副本的容错系统，但他们存在一个相同的特点：**需要单节点来决定多个副本中谁是Primary**。优势在于其决策就是整体的决策，不会带来额外的分布式问题-**脑裂（Split-Brain）**；缺点在于其可能出现的单点故障。

可以认为之前这三个系统将系统的容错关键点转移到了单点，当数据局部出现故障，该单点会将数据的处理转移到最新的主拷贝Primary。用这种方式避免了Split-Brain。同时用这种方式我们要很小心的进行主拷贝的选择，否则也可能产生Split-Brain。

## Majority Vote 过半投票

脑裂问题是上世纪80年代面临的重要挑战，当时人们在构建多副本系统时需要排除脑裂的可能性，但解决方式有两种：

* 构建不可能出现故障的网络
* 人工解决脑裂问题：默认客户端与Primary和Backup都要响应，如果只有一台响应，则不执行操作，由人工将另一台关机，去机房检查服务器，确认工作状态。实际上是将运维人员视为单点进行决策。

这两者都不是很好的解决方式。

后来人们做出了可以**自动进行故障切换**的系统。当网络出现故障时，将网络分割成两半，各自分离、不能互相访问，这种解决方式被称为网络分区。

Raft论文中提出了**过半投票**的方式解决脑裂。在一个过半投票的系统，服务器的数量**必须是奇数**而不是偶数，否则网络分区的两侧对称会导致无法“过半”。
